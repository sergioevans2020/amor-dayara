<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Laberinto - Niveles</title>
<style>
  body {
    font-family: 'Quicksand', sans-serif;
    background: #ffe6f0;
    color: #b30059;
    margin: 0; padding: 0;
    display: flex; flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  body.dark {
    background: #402342;
    color: #f8cde6;
  }
  h1 {
    margin-top: 30px;
    font-family: 'Great Vibes', cursive;
    font-size: 48px;
    user-select: none;
  }
  #mensaje {
    margin: 15px 0 30px 0;
    font-size: 22px;
    font-style: italic;
  }

  #laberinto {
    display: grid;
    grid-template-columns: repeat(8, 40px);
    grid-template-rows: repeat(8, 40px);
    gap: 2px;
    user-select: none;
  }

  .celda {
    width: 40px; height: 40px;
    border-radius: 6px;
    background: #fce4ec;
    box-shadow: inset 0 0 5px #e1bee7;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  body.dark .celda {
    background: #5a3e5f;
    box-shadow: inset 0 0 5px #9575cd;
  }

  .pared {
    background: #b30059;
    box-shadow: none;
    cursor: default;
  }
  body.dark .pared {
    background: #a23e6e;
  }

  .camino {
    background: #f8bbd0;
  }
  body.dark .camino {
    background: #8e6996;
  }

  .jugador {
    background: #d81b60;
    box-shadow: 0 0 8px 2px #ff80ab;
  }
  body.dark .jugador {
    background: #e87cbf;
    box-shadow: 0 0 8px 2px #ffb3d9;
  }

  .salida {
    background: #a5d6a7;
    box-shadow: 0 0 8px 2px #66bb6a;
  }
  body.dark .salida {
    background: #82b366;
    box-shadow: 0 0 8px 2px #a5d6a7;
  }

  /* NavegaciÃ³n */
  #controles {
    margin-top: 30px;
    display: flex;
    gap: 20px;
  }
  button {
    font-family: 'Quicksand', sans-serif;
    font-weight: 600;
    font-size: 18px;
    background: #d880b6;
    color: white;
    border: none;
    border-radius: 12px;
    padding: 10px 20px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(191, 111, 183, 0.7);
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:disabled {
    background: #f0a9d6;
    cursor: not-allowed;
    box-shadow: none;
  }
  button:hover:not(:disabled) {
    background: #bf6fb7;
  }

  /* AnimaciÃ³n celebraciÃ³n */
  #celebracion {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(255, 192, 203, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Great Vibes', cursive;
    font-size: 48px;
    color: #b30059;
    text-shadow: 0 0 8px #ff80ab;
    user-select: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    z-index: 1000;
  }
  #celebracion.show {
    opacity: 1;
    pointer-events: all;
  }
</style>
</head>
<body>
<h1>Laberinto: Nivel <span id="nivel-num">1</span></h1>
<div id="mensaje">Encuentra la salida para avanzar al siguiente nivel.</div>
<div id="laberinto" aria-label="Laberinto"></div>
<div id="controles">
  <button id="btnAnterior" aria-label="Nivel anterior" disabled>â¬… Nivel Anterior</button>
  <button id="btnSiguiente" aria-label="Siguiente nivel" disabled>Siguiente Nivel âž¡</button>
  <button id="btnModo" aria-label="Cambiar modo oscuro/claro">Modo Oscuro</button>
</div>

<div id="celebracion" role="alert" aria-live="assertive">Â¡Felicidades! Nivel completado ðŸ’–</div>

<script>
  const niveles = [
    // Nivel 1 (8x8)
    [
      "XXXXXXXX",
      "X J    X",
      "X XXX XX",
      "X   X  X",
      "XXX X XX",
      "X     SX",
      "X XXX  X",
      "XXXXXXXX"
    ],
    // Nivel 2 (8x8)
    [
      "XXXXXXXX",
      "XJ  X  X",
      "XX XX XX",
      "X  X   X",
      "X XX XXS",
      "X      X",
      "XX XXX X",
      "XXXXXXXX"
    ],
    // Nivel 3 (8x8)
    [
      "XXXXXXXX",
      "XJ X   X",
      "X XX X X",
      "X    X X",
      "XXX XX X",
      "X     SX",
      "X XXXXX",
      "XXXXXXXX"
    ],
    // Nivel 4 (8x8)
    [
      "XXXXXXXX",
      "XJ     X",
      "X XXXX X",
      "X X  X X",
      "X X XX X",
      "X    XSX",
      "XXXXXXXX",
      "XXXXXXXX"
    ],
    // Nivel 5 (8x8)
    [
      "XXXXXXXX",
      "XJ  XX X",
      "X  X X X",
      "XX X X X",
      "X     SX",
      "X XXX XX",
      "X       ",
      "XXXXXXXX"
    ],
    // Nivel 6 (8x8)
    [
      "XXXXXXXX",
      "XJ     X",
      "X XXXX X",
      "X X  X X",
      "X XX X X",
      "X    SX ",
      "XXXXXXXX",
      "XXXXXXXX"
    ]
  ];

  const FILAS = 8;
  const COLUMNAS = 8;

  let nivelActual = 0;
  let jugadorPos = {x:0, y:0};

  const laberintoDiv = document.getElementById('laberinto');
  const mensajeDiv = document.getElementById('mensaje');
  const nivelNumSpan = document.getElementById('nivel-num');
  const btnAnterior = document.getElementById('btnAnterior');
  const btnSiguiente = document.getElementById('btnSiguiente');
  const btnModo = document.getElementById('btnModo');
  const celebracionDiv = document.getElementById('celebracion');

  function dibujarLaberinto() {
    laberintoDiv.innerHTML = '';
    const mapa = niveles[nivelActual];
    for(let y=0; y<FILAS; y++) {
      for(let x=0; x<COLUMNAS; x++) {
        const celda = document.createElement('div');
        celda.classList.add('celda');

        const char = mapa[y][x];
        if(char === 'X') {
          celda.classList.add('pared');
        } else if (char === 'J') {
          celda.classList.add('jugador');
          jugadorPos = {x,y};
        } else if (char === 'S') {
          celda.classList.add('salida');
        } else {
          celda.classList.add('camino');
        }
        celda.setAttribute('data-x', x);
        celda.setAttribute('data-y', y);
        laberintoDiv.appendChild(celda);
      }
    }
  }

  function moverJugador(dx, dy) {
    const mapa = niveles[nivelActual];
    const nx = jugadorPos.x + dx;
    const ny = jugadorPos.y + dy;
    if(nx < 0 || ny < 0 || nx >= COLUMNAS || ny >= FILAS) return; // fuera limites
    const destino = mapa[ny][nx];
    if(destino === 'X') return; // pared
    // Actualizar mapa: cambiar la 'J' vieja por espacio
    let filaArray = mapa[jugadorPos.y].split('');
    filaArray[jugadorPos.x] = ' ';
    mapa[jugadorPos.y] = filaArray.join('');
    // Mover jugador
    filaArray = mapa[ny].split('');
    filaArray[nx] = 'J';
    mapa[ny] = filaArray.join('');
    jugadorPos = {x: nx, y: ny};
    dibujarLaberinto();
    chequearSalida();
  }

  function chequearSalida() {
    if(niveles[nivelActual][jugadorPos.y][jugadorPos.x] === 'S') {
      mostrarCelebracion();
      btnSiguiente.disabled = false;
      mensajeDiv.textContent = "Â¡Nivel completado! Presiona Siguiente Nivel para continuar.";
    } else {
      btnSiguiente.disabled = true;
      mensajeDiv.textContent = "Encuentra la salida para avanzar al siguiente nivel.";
    }
  }

  function mostrarCelebracion() {
    celebracionDiv.textContent = `Â¡Felicidades! Has completado el nivel ${nivelActual+1} ðŸ’–`;
    celebracionDiv.classList.add('show');
    setTimeout(() => {
      celebracionDiv.classList.remove('show');
    }, 3500);
  }

  // Control de botones y teclado
  btnAnterior.addEventListener('click', () => {
    if(nivelActual > 0) {
      nivelActual--;
      iniciarNivel();
    }
  });
  btnSiguiente.addEventListener('click', () => {
    if(nivelActual < niveles.length -1) {
      nivelActual++;
      iniciarNivel();
    }
  });

  btnModo.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    if(document.body.classList.contains('dark')) {
      btnModo.textContent = "Modo Claro";
    } else {
      btnModo.textContent = "Modo Oscuro";
    }
  });

  function iniciarNivel() {
    nivelNumSpan.textContent = nivelActual + 1;
    btnAnterior.disabled = (nivelActual === 0);
    btnSiguiente.disabled = true; // se habilita solo al terminar nivel
    dibujarLaberinto();
    mensajeDiv.textContent = "Encuentra la salida para avanzar al siguiente nivel.";
  }

  window.addEventListener('keydown', (e) => {
    switch(e.key) {
      case 'ArrowUp': moverJugador(0, -1); break;
      case 'ArrowDown': moverJugador(0, 1); break;
      case 'ArrowLeft': moverJugador(-1, 0); break;
      case 'ArrowRight': moverJugador(1, 0); break;
    }
  });

  iniciarNivel();
</script>
</body>
</html>
